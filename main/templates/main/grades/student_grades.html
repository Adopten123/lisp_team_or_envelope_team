{% extends 'main/index.html' %}
{% load static %}
{% load humanize %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/nl_paginator.css' %}">
{% endblock %}

{% block content %}
    <section class="notifications">
        <h2 class="section-title">–û—Ü–µ–Ω–∫–∏</h2>

        <div class="notifications-list">
            {% if page_obj.object_list %}
                {% for c in page_obj.object_list %}
                    <article class="notification-item">
                        <div class="notification-icon">üìä</div>
                        <div class="notification-content">
                            <p class="notification-text">
                                <strong>{{ c.discipline }}</strong>
                            </p>
                            <span class="notification-time">
            –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {{ c.teacher }} ¬∑ –ì—Ä—É–ø–ø–∞: {{ c.group }} ¬∑ {{ c.academic_year }}, {{ c.semester }}
          </span>

                            <!-- –ò—Ç–æ–≥ –ø–æ –∫—É—Ä—Å—É -->
                            <div style="margin-top:10px;">
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                                    <span class="badge">–ò—Ç–æ–≥: {{ c.final_percent }}%</span>
                                    <span class="badge">–û—Ü–µ–Ω–∫–∞: {{ c.final_grade5 }}</span>
                                </div>
                                <div style="height:10px; border-radius:999px; background: rgba(102,126,234,.18);">
                                    <div style="height:10px; width: {{ c.final_percent }}%; max-width:100%;
                                            background: linear-gradient(135deg,#667eea,#764ba2);
                                            border-radius:999px;"></div>
                                </div>
                            </div>

                            <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è -->
                            {% if c.assessments %}
                                <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
                                    {% for a in c.assessments %}
                                        <div style="display:flex; flex-wrap:wrap; align-items:center; gap:8px;">
                                            <span class="badge">{% if a.is_final %}–§–∏–Ω–∞–ª{% else %}
                                                {{ a.type }}{% endif %}</span>
                                            <span class="badge">–í–µ—Å: {{ a.weight }}</span>
                                            <span class="badge">–ú–∞–∫—Å: {{ a.max_points }}</span>
                                            {% if a.last_percent %}
                                                <span class="badge badge--ok">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {{ a.last_percent }}%</span>
                                            {% else %}
                                                <span class="badge">–ù–µ—Ç –æ—Ü–µ–Ω–∫–∏</span>
                                            {% endif %}
                                            {% if a.due_at %}
                                                <span class="badge">–î–µ–¥–ª–∞–π–Ω: {{ a.due_at|naturaltime }}</span>{% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </article>
                {% endfor %}
            {% else %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ü–µ–Ω–∫–∞–º.</p>
            {% endif %}
        </div>

        {# –ü–∞–≥–∏–Ω–∞—Ü–∏—è ‚Äî –ø–æ–¥–∫–ª—é—á–∏, –µ—Å–ª–∏ –≤—ã–Ω–µ—Å –≤ partial; –∏–Ω–∞—á–µ –≤—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π –±–ª–æ–∫ #}
        <nav class="paginator" aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è" style="margin-top:14px;">
            {% if page_obj.has_previous %}
                <a class="badge" href="?page={{ page_obj.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
            {% else %}
                <span class="badge">‚Üê –ù–∞–∑–∞–¥</span>
            {% endif %}

            <span class="badge">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ paginator.num_pages }}</span>

            {% if page_obj.has_next %}
                <a class="badge" href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
            {% else %}
                <span class="badge">–í–ø–µ—Ä—ë–¥ ‚Üí</span>
            {% endif %}
        </nav>
    </section>
{% endblock %}
