{% extends 'main/index.html' %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/applicant_rating.css' %}">
{% endblock %}

{% block content %}
<div class="applicant-rating-page">
    <div class="applicant-rating-container">
        <div class="applicant-rating-header">
            <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</h1>
            <p>–¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π</p>
        </div>

        {% if messages %}
        <div class="applicant-rating-messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
        {% if not ranked_applicants %}
        <div class="test-data-section">
            <div class="test-data-card">
                <h3>üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                <p>–•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Ä–µ–π—Ç–∏–Ω–≥–∞?</p>
                <a href="{% url 'generate_test_applicants' %}" class="submit-btn">
                    üé≤ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                </a>
            </div>
        </div>
        {% endif %}

        {% if ranked_applicants %}
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <span class="stat-value">{{ total_applicants }}</span>
                        <span class="stat-label">–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-info">
                        <span class="stat-value">{{ exam_stats.avg_score|floatformat:1 }}</span>
                        <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-info">
                        <span class="stat-value">{{ ranked_applicants.0.total_score|floatformat:1 }}</span>
                        <span class="stat-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
        <div class="rating-table-section">
            <h2>üìã –ü–æ–ª–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</h2>

            <div class="table-container">
                <table class="rating-table">
                    <thead>
                        <tr>
                            <th class="position-col">–ú–µ—Å—Ç–æ</th>
                            <th class="name-col">–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç</th>
                            <th class="exams-col">–≠–∫–∑–∞–º–µ–Ω—ã</th>
                            <th class="score-col">–û–±—â–∏–π –±–∞–ª–ª</th>
                            <th class="status-col">–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in ranked_applicants %}
                        <tr class="applicant-row {% if item.position <= 3 %}top-applicant{% endif %}">
                            <td class="position-cell">
                                <div class="position-badge {% if item.position == 1 %}first-badge{% elif item.position == 2 %}second-badge{% elif item.position == 3 %}third-badge{% else %}normal-badge{% endif %}">
                                    {% if item.position <= 3 %}
                                        {{ item.position }}
                                    {% else %}
                                        #{{ item.position }}
                                    {% endif %}
                                </div>
                            </td>
                            <td class="name-cell">
                                <div class="applicant-info">
                                    <div class="applicant-name">
                                        {{ item.applicant.person.last_name }} {{ item.applicant.person.first_name }} {{ item.applicant.person.middle_name }}
                                    </div>
                                    <div class="applicant-details">
                                        <span class="detail-item">üìß {{ item.applicant.person.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</span>
                                        {% if item.applicant.school_name %}
                                        <span class="detail-item">üéì {{ item.applicant.school_name }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td class="exams-cell">
                                <div class="exams-list">
                                    {% for exam in item.exams %}
                                    <div class="exam-item">
                                        <span class="exam-subject">{{ exam.subject }}</span>
                                        <span class="exam-type">
                                            {% if exam.exam_type == "USE" %}
                                                (–ï–ì–≠)
                                            {% elif exam.exam_type == "internal" %}
                                                (–≤–Ω—É—Ç—Ä.)
                                            {% else %}
                                                (–¥—Ä.)
                                            {% endif %}
                                        </span>
                                        <span class="exam-score">{{ exam.score }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </td>
                            <td class="score-cell">
                                <div class="total-score">
                                    {{ item.total_score|floatformat:1 }}
                                </div>
                            </td>
                            <td class="status-cell">
                                <span class="status-badge
                                    {% if item.total_score >= 250 %}status-excellent
                                    {% elif item.total_score >= 200 %}status-good
                                    {% elif item.total_score >= 150 %}status-average
                                    {% else %}status-poor
                                    {% endif %}">
                                    {% if item.total_score >= 250 %}–í—ã—Å–æ–∫–∏–π
                                    {% elif item.total_score >= 200 %}–•–æ—Ä–æ—à–∏–π
                                    {% elif item.total_score >= 150 %}–°—Ä–µ–¥–Ω–∏–π
                                    {% else %}–ù–∏–∑–∫–∏–π
                                    {% endif %}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="legend-section">
            <h3>üìñ –õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="legend-color status-excellent"></span>
                    <span>–í—ã—Å–æ–∫–∏–π (250+ –±–∞–ª–ª–æ–≤)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color status-good"></span>
                    <span>–•–æ—Ä–æ—à–∏–π (200-249 –±–∞–ª–ª–æ–≤)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color status-average"></span>
                    <span>–°—Ä–µ–¥–Ω–∏–π (150-199 –±–∞–ª–ª–æ–≤)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color status-poor"></span>
                    <span>–ù–∏–∑–∫–∏–π (–¥–æ 149 –±–∞–ª–ª–æ–≤)</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}