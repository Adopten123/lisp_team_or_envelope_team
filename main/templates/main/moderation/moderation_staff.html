{% extends 'main/index.html' %}
{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/moderation_staff.css' %}">
{% endblock %}

{% block content %}
    <section class="main-content">
        <h2 class="section-title">üë• –ü–µ—Ä—Å–æ–Ω–∞–ª ‚Äî {{ current_university.short_name }}</h2>

        <section class="user-card filters-section">
            <form method="get" class="filters filters--vertical">
                <div class="filters-field">
                    <label for="f_department"
                           style="display:block; font-size:.85rem; color:#666; margin-bottom:6px;">
                        –§–∞–∫—É–ª—å—Ç–µ—Ç (–ø–æ–∏—Å–∫)
                    </label>
                    <input id="f_department"
                           name="department"
                           type="text"
                           value="{{ department_q }}"
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–¢, –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞‚Ä¶"
                           class="filter-input">
                </div>

                <div class="filters-actions">
                    <button type="submit" class="btn-indigo">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    <button class="btn-ghost" type="button"
                            onclick="window.location.href='{% url 'moderation_staff' %}'">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </section>

        {% if can_manage %}
            <section class="user-card create-teacher-section">
                <details class="collapsible">
                    <summary class="btn-indigo-outline">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</summary>
                    <div style="margin-top:12px;">
                        <form method="post"
                              style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:12px; width:100%;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="create">
                            <div>
                                <label style="display:block; font-size:.85rem; color:#666; margin-bottom:6px;">–ß–µ–ª–æ–≤–µ–∫</label>
                                {{ form.person }}
                            </div>
                            <div>
                                <label style="display:block; font-size:.85rem; color:#666; margin-bottom:6px;">–£—á—ë–Ω–æ–µ
                                    –∑–≤–∞–Ω–∏–µ</label>
                                {{ form.academic_title }}
                            </div>
                            <div>
                                <label style="display:block; font-size:.85rem; color:#666; margin-bottom:6px;">–§–∞–∫—É–ª—å—Ç–µ—Ç</label>
                                {{ form.department }}
                            </div>
                            <div style="grid-column:1 / -1; text-align:right;">
                                <button type="submit" class="btn-indigo">–°–æ–∑–¥–∞—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </details>
            </section>
        {% endif %}

        <section class="notifications">
            <h3 class="section-title">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h3>
            <div class="notifications-list">
                {% if page_obj and page_obj.object_list %}
                    {% for t in page_obj.object_list %}
                        <div class="notification-item">
                            <div class="notification-icon">üë®‚Äçüè´</div>
                            <div class="notification-content" style="flex:1;">
                                <p class="notification-text">
                                    <strong>{{ t.person.last_name }}
                                        {{ t.person.first_name }}{% if t.person.middle_name %}
                                            {{ t.person.middle_name }}{% endif %}</strong>
                                    {% if t.department %} ¬∑ –∫–∞—Ñ–µ–¥—Ä–∞ {{ t.department }}{% endif %}
                                </p>
                                <span class="notification-time">{% if t.academic_title %}
                                    {{ t.academic_title }}{% else %}‚Äî{% endif %}</span>
                            </div>
                            {% if can_manage %}
                                <form method="post" style="margin-left:auto;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="teacher_id" value="{{ t.id }}">
                                    <button type="submit" class="btn-danger"
                                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å Teacher? –†–æ–ª—å —á–µ–ª–æ–≤–µ–∫–∞ —Å—Ç–∞–Ω–µ—Ç Guest.');">
                                        –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="notification-item">
                        <div class="notification-icon">‚ÑπÔ∏è</div>
                        <div class="notification-content">
                            <p class="notification-text">–ü–æ–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                            <span class="notification-time">–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è.</span>
                        </div>
                    </div>
                {% endif %}
            </div>

            {% if page_obj and page_obj.paginator.num_pages > 1 %}
                <nav class="paginator" aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è" style="margin-top:14px;">
                    {% if page_obj.has_previous %}
                        <a class="badge"
                           href="?page={{ page_obj.previous_page_number }}&department={{ department_q|urlencode }}">‚Üê
                            –ù–∞–∑–∞–¥</a>
                    {% else %}
                        <span class="badge">‚Üê –ù–∞–∑–∞–¥</span>
                    {% endif %}

                    <span class="badge">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

                    {% if page_obj.has_next %}
                        <a class="badge"
                           href="?page={{ page_obj.next_page_number }}&department={{ department_q|urlencode }}">–í–ø–µ—Ä—ë–¥
                            ‚Üí</a>
                    {% else %}
                        <span class="badge">–í–ø–µ—Ä—ë–¥ ‚Üí</span>
                    {% endif %}
                </nav>
            {% endif %}
        </section>
    </section>
{% endblock %}
