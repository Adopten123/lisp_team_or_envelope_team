{% extends 'main/index.html' %}
{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/org_tree.css' %}">
{% endblock %}

{% block content %}
    <section class="main-content">
        <h2 class="section-title">üèõ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç: {{ current_university.short_name }}</h2>

        <section class="user-card" style="margin-bottom:12px;">
            <div class="forms-grid">
                {% if can_create_faculty %}
                    <details class="collapsible" open>
                        <summary class="btn-indigo-outline">‚ûï –°–æ–∑–¥–∞—Ç—å —Ñ–∞–∫—É–ª—å—Ç–µ—Ç</summary>
                        <div class="form-body">
                            <form method="post" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="create_faculty">
                                <div class="form-row">
                                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞</label>
                                    {{ faculty_form.name }}
                                    {% if faculty_form.name.errors %}
                                        <div class="form-error">{{ faculty_form.name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-indigo">–°–æ–∑–¥–∞—Ç—å —Ñ–∞–∫—É–ª—å—Ç–µ—Ç</button>
                                </div>
                            </form>
                        </div>
                    </details>
                {% endif %}

                <details class="collapsible">
                    <summary class="btn-indigo-outline">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞—Ñ–µ–¥—Ä—É/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</summary>
                    <div class="form-body">
                        <form method="post" novalidate>
                            {% csrf_token %}
                            <input type="hidden" name="action" value="create_program">
                            <div class="form-row">
                                <label>–§–∞–∫—É–ª—å—Ç–µ—Ç</label>
                                {{ program_form.faculty }}
                                {% if program_form.faculty.errors %}
                                    <div class="form-error">{{ program_form.faculty.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="form-row">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                                {{ program_form.name }}
                                {% if program_form.name.errors %}
                                    <div class="form-error">{{ program_form.name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="form-row two">
                                <div>
                                    <label>–ö–æ–¥</label>
                                    {{ program_form.code }}
                                </div>
                                <div>
                                    <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ª–µ—Ç)</label>
                                    {{ program_form.duration_years }}
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-indigo">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ñ–µ–¥—Ä—É</button>
                            </div>
                        </form>
                    </div>
                </details>
            </div>
        </section>

        <section class="user-card">
            <h3 class="tree-title">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–æ–≤ –∏ –∫–∞—Ñ–µ–¥—Ä</h3>
            {% if faculties %}
                <div class="faculty-grid">
                    {% for f in faculties %}
                        <article class="faculty-card">
                            <header class="faculty-header">
                                <div class="faculty-pill">–§–ê–ö–£–õ–¨–¢–ï–¢</div>
                                <h4 class="faculty-name">{{ f.name }}</h4>
                                <div class="faculty-meta">
                                    –ö–∞—Ñ–µ–¥—Ä: {{ f.programs.all|length }}
                                </div>
                            </header>

                            {% if f.programs.all %}
                                <div class="programs-wrap">
                                    {% for p in f.programs.all %}
                                        <div class="program-chip" title="{{ p.name }}">
                                            <span class="program-dot"></span>
                                            <span class="program-name">{{ p.name }}</span>
                                            {% if p.code %}<span class="program-code">{{ p.code }}</span>{% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="programs-empty">
                                    –ù–µ—Ç –∫–∞—Ñ–µ–¥—Ä ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –≤—ã—à–µ
                                </div>
                            {% endif %}
                        </article>
                    {% endfor %}
                </div>
            {% else %}
                <div class="notification-item">
                    <div class="notification-icon">‚ÑπÔ∏è</div>
                    <div class="notification-content">
                        <p class="notification-text">–§–∞–∫—É–ª—å—Ç–µ—Ç—ã –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</p>
                        <span class="notification-time">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç –∏–ª–∏ –∫–∞—Ñ–µ–¥—Ä—É –≤—ã—à–µ.</span>
                    </div>
                </div>
            {% endif %}
        </section>
    </section>
{% endblock %}
