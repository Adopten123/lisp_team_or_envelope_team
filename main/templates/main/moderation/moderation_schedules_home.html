{% extends 'main/index.html' %}
{% load static %}
{% load ui_extras %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/moderation_forms.css' %}">
    <link rel="stylesheet" href="{% static 'css/schedule_moderation_forms.css' %}">
{% endblock %}

{% block content %}
    <section class="main-content">
        <h2 class="section-title">üóìÔ∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</h2>

        <!-- –§–∏–ª—å—Ç—Ä—ã: –ø–æ–∏—Å–∫ + –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã -->
        <section class="user-card" style="margin-bottom:12px;">
            <form method="get" style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
                <select name="group" class="action-card" style="padding:10px; border-radius:10px; min-width:260px;">
                    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É ‚Äî</option>
                    {% for g in groups %}
                        <option value="{{ g.id }}" {% if group and g.id == group.id %}selected{% endif %}>
                            {{ g.name }} ¬∑ {{ g.program.name }} ({{ g.university.short_name }})
                        </option>
                    {% endfor %}
                </select>
                <button class="btn btn-indigo" type="submit">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                <a class="btn btn-ghost" href="{% url 'moderation_schedules' %}">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </form>
        </section>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <section class="user-card" style="margin-bottom:12px;">
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <a class="btn btn-indigo"
                   href="{% url 'schedule_slot_create' %}{% if group %}?group={{ group.id }}{% endif %}">
                    –î–æ–±–∞–≤–∏—Ç—å —è—á–µ–π–∫—É (ScheduleSlot)
                </a>
                <a class="btn btn-ghost"
                   href="{% url 'schedule_exception_create' %}{% if group %}?group={{ group.id }}{% endif %}">
                    –î–æ–±–∞–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (ScheduleException)
                </a>
            </div>
        </section>

        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–∫–∞–∫ —É —Å—Ç—É–¥–µ–Ω—Ç–∞) -->
        <section class="notifications">
            {% if group %}
                <h3 class="section-title" style="font-size:1.05rem;">
                    –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({{ today|date:"d.m.Y" }}) ‚Äî {{ group.name }}
                </h3>

                <div class="week-grid">
                    {% for i in weekdays %}
                        <div class="day-column">
                            <div class="day-head">
        <span class="day-title">
          {% if i == 1 %}–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫{% elif i == 2 %}–í—Ç–æ—Ä–Ω–∏–∫{% elif i == 3 %}–°—Ä–µ–¥–∞{% elif i == 4 %}
              –ß–µ—Ç–≤–µ—Ä–≥{% elif i == 5 %}–ü—è—Ç–Ω–∏—Ü–∞{% elif i == 6 %}–°—É–±–±–æ—Ç–∞{% else %}–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ{% endif %}
        </span>
                            </div>

                            <div class="day-body">
                                {% with day_items=week|get_item:i %}
                                    {% if day_items %}
                                        {% for item in day_items %}
                                            {% with eff=item.today_effective %}
                                                <div class="slot-card {% if eff and eff.0 %}slot-cancelled{% endif %}">
                                                    <div class="slot-time">
                                                        {% if eff %}
                                                            {% if eff.0 %}‚Äî{% else %}{{ eff.1|time:"H:i" }}‚Äì
                                                                {{ eff.2|time:"H:i" }}{% endif %}
                                                        {% else %}
                                                            {{ item.slot.start_time|time:"H:i" }}‚Äì
                                                            {{ item.slot.end_time|time:"H:i" }}
                                                        {% endif %}
                                                    </div>
                                                    <div class="slot-main">
                                                        <div class="slot-title">
                                                            {{ item.slot.teaching.curriculum.discipline.title }}
                                                        </div>
                                                        <div class="slot-meta">
                                                            {{ item.slot.teaching.teacher.person.last_name }} {{ item.slot.teaching.teacher.person.first_name }}
                                                            {% if eff and eff.3 or eff and eff.4 %} ¬∑ {{ eff.3 }}
                                                                {{ eff.4 }}{% endif %}
                                                            {% if eff and eff.5 %} ¬∑ {{ eff.5 }}{% endif %}
                                                            {% if eff and eff.0 %} ¬∑ <strong>–û–¢–ú–ï–ù–ê</strong>{% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endwith %}
                                        {% endfor %}
                                    {% else %}
                                        <div class="slot-empty">–ù–µ—Ç –ø–∞—Ä</div>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="notification-item">
                    <div class="notification-icon">‚ÑπÔ∏è</div>
                    <div class="notification-content">
                        <p class="notification-text">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.</p>
                    </div>
                </div>
            {% endif %}
        </section>
    </section>
{% endblock %}